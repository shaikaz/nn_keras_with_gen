nn_keras_with_gen